#!/usr/bin/bash

# `cargo` wrapper

/usr/bin/cargo "$@"
let stat=$?

function init_repo()
{
    local readme_dest="$1"
    local license_dest="$2"

    # Copy template README and MIT license files into new repo
    cp "${XDG_CONFIG_HOME}/git/README_template.md" "${readme_dest}"
    cp "${XDG_CONFIG_HOME}/git/MIT_license_template" "${license_dest}"

    # Replace placeholder fields, i.e. [year] with the current year and
    # [fullname] with the value of `user.name` set in gitconfig
    sed -e "s/\[year\]/$(date +%Y)/" \
        -e "s/\[fullname\]/$(git config --global --get user.name)/" \
        -i "${license_dest}"

    $EDITOR "${readme_dest}"
}

if [[ "$1" == "new" ]] && [[ ! -z "$2" ]]; then
    init_repo "$2/README.md" "$2/LICENSE"
elif [[ "$1" == "init" ]]; then
    init_repo "README.md" "LICENSE"
fi

exit $stat
