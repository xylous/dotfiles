#!/usr/bin/bash

### cwallpaperd - change wallpaper daemon
## author: xylous <xylous.e@gmail.com>
# periodically change the wallpaper

# directory containing the wallpapers to be used
readonly WALLPAPERS_DIR="${XDG_CONFIG_HOME}/wallpapers"
# symlink pointing to the current wallpaper
readonly WALLPAPER_SYMLINK="${XDG_CONFIG_HOME}/wallpaper"
# change wallpaper every N minutes
readonly CHANGE_EVERY=$((60))

function main()
{
    local old="$(readlink -f "${WALLPAPER_SYMLINK}")"
    while true; do
        # pick a random wallpaper to use, as long as it's different from the
        # last one
        local new="${old}"
        while [[ "${new}" == "${old}" ]]; do
            new="$(find -L "${WALLPAPERS_DIR}" -maxdepth 1 -type f -print0 | shuf -z -n 1 | tr -d '\000')"
        done
        wallpaper "${new}"

        sleep $((60 * CHANGE_EVERY))
    done
}

main @
