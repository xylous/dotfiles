#!/usr/bin/sh

### drupar, written by xylous <xylous.e@gmail.com>
## requires drivejs
# Compress a directory or a file into a tar.gz archive and upload it to Google
# Drive via drivejs

function main()
{
    local inputpath="$1"

    # Remove path from the argument string.
    if (( $# > 0 )); then
        shift 1
    fi

    declare workdir="$(mktemp --directory)"
    declare archivename="$(basename "${inputpath}")"
    declare archivepath="${workdir}/${archivename}.tar.gz"

    tarargs=$@
    tarargs+=" -czf ${archivepath} -C ${inputpath}/.. ${archivename}"

    echo "Creating a tar.gz archive..."
    tar ${tarargs}
    if [[ -f "${archivepath}" ]]; then
        echo "Uploading archive to Google Drive..."
        drivejs up "${archivepath}"
    else
        echo "error: no file; nothing to upload to Google Drive"
    fi
    echo "Cleaning up temporary files..."
    rm -rf "${workdir}"
}

main $@
