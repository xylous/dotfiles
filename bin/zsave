#!/usr/bin/sh

### zsave, written by xylous <xylous.e@gmail,com>
# Compress the zettelkasten into a tar archive and upload it to Google Drive

declare zk_path="$(settle zk)"

if [[ "$1" == "backup" ]]; then
    declare workdir="$(mktemp --directory)"

    tar --exclude=*.sql \
        -czf "${workdir}/zettelkasten.tar.gz" -C "${zk_path}/.." zettelkasten
    drivejs up "${workdir}/zettelkasten.tar.gz"
    rm -rf "${workdir}"
elif [[ "$1" == "restore" ]]; then
    if [[ -z "$2" ]]; then
        echo "no archive to restore from specified"
        exit 1
    fi
    tar -xzf "$2"
    rm -rf "${zk_path}"
    mv -i zettelkasten --no-target-directory "${zk_path}"
else
    echo "only commands are: 'backup', 'restore <PATH_TO_ARCHIVE>'"
fi
